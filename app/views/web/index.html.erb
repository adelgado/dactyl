<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//cdn.muicss.com/mui-0.1.18/css/mui.min.css" rel="stylesheet" type="text/css" />
    <script src="//cdn.muicss.com/mui-0.1.18/js/mui.min.js"></script>
    <%= stylesheet_link_tag    "application", :media => "all" %>
</head>

<body>

    <div class="mui-container">
        <% unless @report %>
        <div class="logo">
            <%= image_tag 'dactyl-logo' %>
        </div>
        <% end %>

        <%= form_tag(params.except(:text), method: :post, class: 'mui-panel') do %>
            <legend>Analyze text 'n stuff with Dactyl</legend>

            <div class="mui-form-group">
                <textarea class="mui-form-control" name="text" rows="10"><%= @report[:original_string] if @report %></textarea>
                <label class="mui-form-floating-label">Write or paste your text here</label>
            </div>
            <button type="submit" class="mui-btn mui-btn-default mui-btn-primary mui-btn-raised">Analyze</button>
            <%= link_to "Clear", nil, class: "mui-btn mui-btn-default mui-btn-raised" %>
            <% if @analysis_string.presence %>
                <%= link_to "View as API call", "/api/v1/dactyl?text=#{CGI.escape @analysis_string}", class: "mui-btn mui-btn-raised" %>
            <% end %>
        <% end %>

        <% @report && @report[:metrics].keys.each do |category| %>
        <table class="mui-table mui-table-bordered mui-panel">
            <thead>
                <tr>
                    <td colspan="2" class="metric-category-row"><%= category.to_s.humanize %></td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th width="40%">Metric</th>
                    <th>Value</th>
                </tr>
                <% @report[:metrics][category].each do |metric, value| %>
                <tr>
                    <td><%= metric.humanize %></td>
                    <td>
                        <%= case value
                            when Float
                                value *= 100 if metric.end_with?('_percentage')
                                [
                                    number_with_precision(value, precision: 3),
                                    metric.end_with?('_percentage') ? ' %' : ''
                                ].join

                            when Hash then "<pre>#{value}</pre>".html_safe
                            when Array then "<pre>#{value.to_s}</pre>".html_safe

                            else value
                        end
                        %>
                    </td>
                </tr>
                <% end %>
            </tbody>
        </table>

        <% end %>

        <div style="text-align: center">
            Powered by <a href="http://indentlabs.com">Indent Labs</a>
        </div>
    </div>

</body>
</html>